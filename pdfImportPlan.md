## خطة استيراد كتاب PDF (أكثر من 120 صفحة / 10 فصول)

هدف: ضمان أن محتوى الكتاب المعروض في التطبيق يطابق تمامًا ملف PDF المصدر دون نسخ يدوي مرهق أو أخطاء OCR.

### التحدي الحالي
لا يمكنني الوصول المباشر لنص الـPDF المرفق داخل بيئة التحرير الحالية، والمحتوى الموجود حاليًا في `bookData.tsx` هو نسخة مُحررة موجزة. نريد تطابقًا 1:1 مع الفصول العشرة الكاملة.

### مسار الحل
1. إضافة مكتبة `pdfjs-dist` لاستخراج النص داخل المتصفح (عميل) من ملف PDF يرفعه المستخدم (لوحة الإدارة).
2. تحليل النص صفحةً صفحةً واستخراج العناوين الرئيسية للفصول والأقسام باستخدام تعبيرات منتظمة (Regex) عربية: 
   - مثال: `/^\s*(الفصل\s+\w+|القسم\s+الأول|الخاتمة|المقدمة)/m`
3. تجميع النص إلى كتل فصل (Chapter Blocks) مع الاحتفاظ بترتيب الصفحات.
4. بناء نموذج بيانات وسيط:
```ts
interface RawPdfPage { index: number; text: string; }
interface ChapterDraft { id: string; title: string; pages: number[]; raw: string; }
```
5. مقارنة العناوين المستخرجة مع عناوين `bookContent` الحالية لتحديد:
   - فصول ناقصة.
   - فصول مختصرة تحتاج استبدال بالنص الكامل.
6. واجهة إدارة:
   - زر رفع PDF.
   - شريط تقدم (progress) أثناء القراءة.
   - جدول Diff: (العنوان + حالة: مطابق / ناقص / يحتاج تحديث + أزرار "استبدال" و"دمج").
7. عند اعتماد فصل، يُحوّل النص الخام إلى JSX (مع تقسيم فقرات). 
   - تحويل فواصل الأسطر المتتالية إلى `<p>`.
   - العناوين الفرعية تتحول إلى `<h4>` أو `<h5>` وفقًا للنمط.
8. حفظ النتيجة النهائية ككود (توليد ملف `bookData.generated.tsx`) حتى يبقى ثابتًا ويُخضع للمراجعة والتحكم بالإصدار.
9. إضافة مؤشر في التطبيق لاختيار النسخة: (مصدر ثابت / نسخة PDF مستوردة).

### اكتشاف الحدود والعناوين
سنبحث عن أنماط شائعة في الكتب العربية:
- `الفصل الأول:` ، `الفصل الثاني:` ...
- `القسم الأول:` ، `القسم الثاني:` ...
- `الخاتمة` ، `الملاحق` ، `شكر وتقدير`.
نستخدم Regex متعددة بالتسلسل حتى نغطي كل التنويعات.

### معالجة أخطاء OCR المحتملة
بعد استخراج النص:
1. تطبيق قائمة تصحيح شائعة (مثل الاصطناعي/تقنية/الذكاء/إلى/لا يتجزأ...).
2. إحصاء الكلمات الشاذة (تكرار منخفض + حروف منفصلة). عرضها للمراجعة اليدوية قبل التوليد.

### حدود تقنية
- استخراج التنسيق (مثل الجداول أو القوائم) يتطلب تحليلًا أعمق؛ كبداية سنعتمد على فواصل الأسطر.
- إن وُجدت صور أو مخططات ستُتجاهل مبدئيًا (يمكن لاحقًا إضافة OCR للصور).

### خطوات تنفيذ لاحقة (Sprint صغير)
1. إضافة اعتماد pdfjs-dist في `package.json`.
2. إنشاء مكون: `components/PdfImporter.tsx`.
3. خدمة parsing: `services/pdfParser.ts`.
4. توليد ملف نتائج: `data/bookData.generated.tsx`.
5. تعديل صفحة الإدارة لإظهار أداة الاستيراد.

### ما نحتاجه منك
- تأكيد أن العناوين في الـPDF تتبع نمطًا قياسيًا (مثال: "الفصل الأول:" وليس صيغة مختلفة).
- إن وُجد فهرس، تزويدي بنسخة نصية له لتسريع المطابقة.

### نجاح المهمة
- جميع الفصول العشرة موجودة في الناتج الجديد بنفس ترتيب PDF.
- عدد الكلمات الإجمالي قريب (±5%).
- لا توجد أخطاء OCR جسيمة (قائمة مراجعة أقل من 15 كلمة تحتاج تصحيح يدوي).

### امتداد مستقبلي (Optional)
- زر "إعادة استخراج" لاختبار إصدار محدث من PDF.
- دعم حفظ التعليقات التحريرية لكل فصل.
- مقارنة Semantic Diff باستخدام تشابه embeddings لاحقًا.

---
هذه الخطة جاهزة للتنفيذ. بعد موافقتك أبدأ بإضافة الاعتماد وكتابة الأداة الأولية.